<!DOCTYPE html>
<!--
	NOTES:
	1. All tokens are represented by '$' sign in the template.
	2. You can write your code only wherever mentioned.
	3. All occurrences of existing tokens will be replaced by their appropriate values.
	4. Blank lines will be removed automatically.
	5. Remove unnecessary comments before creating your template.
-->
<html>
<head>
<meta charset="UTF-8">
<meta name="authoring-tool" content="Adobe_Animate_CC">
<title>halloweenPuzzle_kk_12_woSound</title>
<!-- write your code here -->
<style>
  #animation_container {
	position:absolute;
	margin:auto;
	left:0;right:0;
	top:0;bottom:0;
  }
</style>
<script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
<script src="halloweenPuzzle_kk_12_woSound.js?1697837020606"></script>
<script>
// Global Scripts
	var rootRef;
//calculating stage bounds for rescaling*var stageWidth;
var stageWidth;
var stageHeight;
var scaleAdjustment = 1.25;
function getStageBounds() {
	stageWidth = stage.canvas.width / stage.scaleX;
	stageHeight = stage.canvas.height / stage.scaleY;
}
var centeredShiftX = 0;
var centeredShiftY = 0;
function getCenteredShift (){
	centeredShiftX = (window.innerWidth - stage.canvas.width/scaleAdjustment) / (2 * stage.scaleX/scaleAdjustment);
	centeredShiftY = (window.innerHeight - stage.canvas.height/scaleAdjustment) / (2 * stage.scaleY/scaleAdjustment);
	console.log("centered shift X" + centeredShiftX);
}
var targetOpacity = 0.18;
var pieceMovingOpacity = 0.3;
var pieceStartingOpacity = 1;
var totalPieces = 16;
var totalMatches = 0;
var activePiece = 0;
var clickShiftX = 0;
var clickShiftY = 0;
function initialize(){
	for (i = 1; i <= totalPieces; i++){
		console.log(i);
		var piece = eval("rootRef.hp" + i)
		piece.num = i;
		console.log(piece.name);
		pieceStartingPlace(piece);
		listen(piece);
		piece.isPlaced = false;
		piece.cursor = "grab";
		var pieceTarget = eval("rootRef.hp" + i + "_target");
		pieceTarget.alpha = targetOpacity;
	}
}
function pieceStartingPlace(piece){
	piece.startingX = piece.x;
	piece.startingY = piece.y;
}
function reInitialize(){
	activePiece = 0;
	totalMatches = 0;
	for (i = 1; i <= totalPieces; i++){
		console.log(i);
		var piece = eval("rootRef.hp" + i);
		console.log(piece.name);
		piece.x = piece.startingX;
		piece.y = piece.startingY;
		piece.isPlaced = false;
		piece.cursor = "grab";
		var pieceTarget = eval("rootRef.hp" + i + "_target");
		pieceTarget.alpha = targetOpacity;
	}
	rootRef.almostDoneAnimation.gotoAndStop("setUp");
	rootRef.batsAnimation.gotoAndStop("setUp");
	rootRef.tombstoneAnimation.gotoAndStop("setUp");
	rootRef.doorAnimation.gotoAndStop("setUp");
	rootRef.skyAnimation.gotoAndStop("setUp");
}
//if piece has been successfully placed, drop piece in place
function drop(piece) {
	pieceTarget = eval("rootRef." + piece.name + "_target");
	piece.alpha = 1;
	piece.x = pieceTarget.x;
	piece.y = pieceTarget.y;
	piece.isPlaced = true;
	piece.cursor = "default";
//	createjs.Sound.play("click");
	totalMatches ++;
	checkMatches(piece);
}
//if piece has not been placed correctly, return to original spot
function replace(piece){
	piece.x = piece.startingX;
	piece.y = piece.startingY;
	activePiece.cursor = "grab";
	activePiece.alpha = pieceStartingOpacity;
}
function checkMatches(piece){
	if (totalMatches == totalPieces){
		rootRef.gotoAndStop("endGame");
		activePiece = 0;
	} else if (totalMatches == (totalPieces - 1)){
//		createjs.Sound.play("chain");
//		createjs.Sound.play("wind");
//		createjs.Sound.play("thunder");
//		createjs.Sound.play("alien");
//		createjs.Sound.play("ghost");
		rootRef.almostDoneAnimation.gotoAndPlay("startAnim");
		activePiece = 0;
	} else if ((piece.num == 7 && rootRef.hp3.isPlaced) ||
		piece.num == 3 && rootRef.hp7.isPlaced){
//		createjs.Sound.play("wind");
		rootRef.batsAnimation.gotoAndPlay("startAnim");
	} else if ((piece.num == 13 && rootRef.hp9.isPlaced) || 
	(piece.num == 9 && rootRef.hp13.isPlaced)){
//		createjs.Sound.play("chain");
//		createjs.Sound.play("growl");
		rootRef.tombstoneAnimation.gotoAndPlay("startAnim");
	} else if ((piece.num == 10 && rootRef.hp11.isPlaced)||
	(piece.num == 11 && rootRef.hp10.isPlaced)) {
//		createjs.Sound.play("ghost");
		rootRef.doorAnimation.gotoAndPlay("startAnim");
	} else if ((piece.num == 1 && rootRef.hp2.isPlaced && rootRef.hp6.isPlaced)||
	(piece.num == 2 && rootRef.hp1.isPlaced && rootRef.hp6.isPlaced)||
	(piece.num == 6 && rootRef.hp1.isPlaced && rootRef.hp2.isPlaced)){
//		createjs.Sound.play("wind");
//		createjs.Sound.play("thunder");
		rootRef.skyAnimation.gotoAndPlay("startAnim");
	}
}
//click and drag functions
/*function onMouseMove(evt){
	if (!activePiece.isPlaced) {
		console.log("onMouseMove occurred");
		activePiece.alpha = pieceMovingOpacity;
		activePiece.cursor = "grabbing";
		console.log("centeredShiftX: " + centeredShiftX);
		console.log("centeredShiftY: " + centeredShiftY)
		activePiece.x = (scaleAdjustment * evt.pageX/stage.scaleX - clickShiftX) - centeredShiftX;
		activePiece.y = (scaleAdjustment * evt.pageY/stage.scaleY - clickShiftY) - centeredShiftY;
	}
}*/
function onMouseUp(evt){
	if (rootRef.currentLabel == "puzzle"){
		if (activePiece != 0 && !activePiece.isPlaced){
			checkLocation(activePiece);
		}
	} else {
		activePiece = 0;
	}
}
function listen(piece){
	piece.onMouseDown = function(evt) {
		activePiece = this;
		clickShiftX = evt.stageX/stage.scaleX - activePiece.x;
		clickShiftY = evt.stageY/stage.scaleY - activePiece.y;
	}
	piece.addEventListener("mousedown" , piece.onMouseDown.bind(piece));
}
function checkLocation(piece){
	var pieceTarget = eval("rootRef."+ piece.name + "_target");
	console.log(pieceTarget.name);
	if (hitTestMCOneThirdBounds(piece, pieceTarget)){
		drop(piece);
	} else {
		replace(piece);
	}
}
//scaling and hit test code credited to Josh Morgan
function getGlobalScale(mc, axis = "both x and y", scaleFactor = 1)
{
	switch (axis)
	{
		case ("x"):
			scaleFactor *= mc.scaleX;
			break;
		case ("y"):
			scaleFactor *= mc.scaleY;
			break;
		default:
			scaleFactor *= mc.scale;
			break;
	}
	if ((mc.parent != rootRef))
	{
		scaleFactor *= getGlobalScale(mc.parent, axis);
	}
	return scaleFactor;
}
function hitTestMCOneThirdBounds(mc1, mc2)
{
	var globalPt1 = mc1.parent.localToGlobal(mc1.x, mc1.y);
	var globalPt2 = mc2.parent.localToGlobal(mc2.x, mc2.y);
	var xDist = globalPt2.x - globalPt1.x;
	var yDist = globalPt2.y - globalPt1.y;
	var mc1HalfWidth = (mc1.nominalBounds.width * getGlobalScale(mc1, "x")) / 2;
	var mc1HalfHeight = (mc1.nominalBounds.height * getGlobalScale(mc1, "y")) / 2;
	var mc2HalfWidth = (mc2.nominalBounds.width * getGlobalScale(mc2, "x")) / 2;
	var mc2HalfHeight = (mc2.nominalBounds.height * getGlobalScale(mc2, "y")) / 2;
	var rangeX = (mc1HalfWidth + mc2HalfWidth)/3;
	var rangeY = (mc1HalfHeight + mc2HalfHeight)/3;
	rangeX *= stage.scaleX;
	rangeY *= stage.scaleY;
	return Math.abs(xDist) < rangeX && Math.abs(yDist) < rangeY;
}</script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
function init() {
	canvas = document.getElementById("canvas");
	anim_container = document.getElementById("animation_container");
	dom_overlay_container = document.getElementById("dom_overlay_container");
	var comp=AdobeAn.getComposition("0AD6715E1C6EB64DB351CF9A08F22035");
	var lib=comp.getLibrary();
	createjs.MotionGuidePlugin.install();
	var loader = new createjs.LoadQueue(false);
	loader.installPlugin(createjs.Sound);
	loader.addEventListener("fileload", function(evt){handleFileLoad(evt,comp)});
	loader.addEventListener("complete", function(evt){handleComplete(evt,comp)});
	var lib=comp.getLibrary();
	loader.loadManifest(lib.properties.manifest);
}
function handleFileLoad(evt, comp) {
	var images=comp.getImages();	
	if (evt && (evt.item.type == "image")) { images[evt.item.id] = evt.result; }	
}
function handleComplete(evt,comp) {
	//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
	var lib=comp.getLibrary();
	var ss=comp.getSpriteSheet();
	var queue = evt.target;
	var ssMetadata = lib.ssMetadata;
	for(i=0; i<ssMetadata.length; i++) {
		ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
	}
	exportRoot = new lib.halloweenPuzzle_kk_12_woSound();
	stage = new lib.Stage(canvas);	
	//Registers the "tick" event listener.
	fnStartAnimation = function() {
		stage.addChild(exportRoot);
		createjs.Ticker.framerate = lib.properties.fps;
		createjs.Ticker.addEventListener("tick", stage);
	}	    
	//Code to support hidpi screens and responsive scaling.
	AdobeAn.makeResponsive(true,'both',true,1,[canvas,anim_container,dom_overlay_container]);	
	AdobeAn.compositionLoaded(lib.properties.id);
	fnStartAnimation();
}
function playSound(id, loop, offset) {
	return createjs.Sound.play(id, {'interrupt':createjs.Sound.INTERRUPT_EARLY, 'loop': loop, 'offset': offset});}
</script>
<!-- write your code here -->
</head>
<body onload="init();" style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(177, 169, 169, 1.00); width:640px; height:480px">
		<canvas id="canvas" width="640" height="480" style="position: absolute; display: block; background-color:rgba(177, 169, 169, 1.00);"></canvas>
		<div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:640px; height:480px; position: absolute; left: 0px; top: 0px; display: block;">
		</div>
	</div>
</body>
</html>